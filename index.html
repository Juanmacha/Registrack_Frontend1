<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" href="/images/logo.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Registrack</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.css"
    />
    <!-- Google Fonts - Poppins + Open Sans -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;1,300;1,400;1,500;1,600;1,700;1,800&family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;1,300;1,400;1,500;1,600;1,700;1,800&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div id="root"></div>
    
    <!-- Filtro de errores de extensiones - Se ejecuta antes de React -->
    <script>
      // Filtro global de errores de extensiones del navegador - VERSI√ìN AGRESIVA
      (function() {
        // Guardar funciones originales
        const originalConsoleError = console.error;
        const originalConsoleWarn = console.warn;
        const originalConsoleLog = console.log;
        
        // Funci√≥n para detectar errores de extensiones - M√ÅS AGRESIVA
        function isExtensionError(message) {
          if (typeof message !== 'string') return false;
          
          return (
            // Errores de extensiones de escritura/IA
            (message.includes('permission error') && 
             (message.includes('pathPrefix') || message.includes('reqInfo'))) ||
            
            // Errores de extensiones de generaci√≥n de contenido
            (message.includes('code: 403') && 
             (message.includes('generate') || message.includes('tone') || message.includes('writing'))) ||
            
            // Errores de extensiones de integraci√≥n de sitios
            (message.includes('site_integration') || message.includes('template_list')) ||
            
            // Errores de extensiones de Chrome
            (message.includes('chrome-extension://') && message.includes('403')) ||
            
            // Errores de extensiones de Grammarly, LanguageTool, etc.
            (message.includes('grammarly') || message.includes('languagetool') || message.includes('whisk')) ||
            
            // Errores espec√≠ficos de extensiones con pathPrefix
            (message.includes('pathPrefix: \'/generate\'') || 
             message.includes('pathPrefix: \'/writing\'') || 
             message.includes('pathPrefix: \'/site_integration\'')) ||
            
            // Errores con reqInfo y pathPrefix
            (message.includes('reqInfo:') && message.includes('pathPrefix:')) ||
            
            // Errores de background.js de extensiones
            (message.includes('background.js') && message.includes('permission error')) ||
            
            // NUEVOS PATRONES AGRESIVOS
            message.includes('Uncaught (in promise) Object') ||
            message.includes('code: 403') ||
            message.includes('msg: \'permission error\'') ||
            message.includes('error: \'exceptions.UserAuthError\'') ||
            message.includes('handled: false') ||
            message.includes('httpError: false') ||
            message.includes('httpStatus: 200') ||
            message.includes('httpStatusText: ""') ||
            message.includes('message: "permission error"') ||
            message.includes('name: "i"') ||
            message.includes('originalError: {name: \'Error\'') ||
            message.includes('stack: \'Error: permission error') ||
            message.includes('at te.handleRes') ||
            message.includes('at Te.handleRes') ||
            message.includes('background.js:4644') ||
            message.includes('background.js:4556') ||
            message.includes('[[Prototype]]: Object') ||
            message.includes('Understand this error')
          );
        }
        
        // Filtrar console.error - M√ÅS AGRESIVO
        console.error = function(...args) {
          const message = args[0]?.toString() || '';
          if (isExtensionError(message)) {
            // No hacer nada, simplemente ignorar
            return;
          }
          originalConsoleError.apply(console, args);
        };
        
        // Filtrar console.warn - M√ÅS AGRESIVO
        console.warn = function(...args) {
          const message = args[0]?.toString() || '';
          if (isExtensionError(message)) {
            // No hacer nada, simplemente ignorar
            return;
          }
          originalConsoleWarn.apply(console, args);
        };
        
        // Filtrar console.log - M√ÅS AGRESIVO
        console.log = function(...args) {
          const message = args[0]?.toString() || '';
          if (isExtensionError(message)) {
            // No hacer nada, simplemente ignorar
            return;
          }
          originalConsoleLog.apply(console, args);
        };
        
        // Filtrar errores no capturados - M√ÅS AGRESIVO
        window.addEventListener('error', function(event) {
          const message = event.message || event.error?.message || '';
          if (isExtensionError(message)) {
            event.preventDefault();
            event.stopPropagation();
            event.stopImmediatePropagation();
            return false;
          }
        }, true); // Usar capture phase
        
        // Filtrar promesas rechazadas - M√ÅS AGRESIVO
        window.addEventListener('unhandledrejection', function(event) {
          const message = event.reason?.message || event.reason?.toString() || '';
          const reason = event.reason;
          
          if (isExtensionError(message) || 
              (reason && typeof reason === 'object' && 
               (reason.code === 403 && reason.reqInfo && reason.reqInfo.pathPrefix))) {
            event.preventDefault();
            event.stopPropagation();
            event.stopImmediatePropagation();
            return false;
          }
        }, true); // Usar capture phase
        
        // Interceptar console.error globalmente
        Object.defineProperty(window, 'console', {
          value: {
            ...console,
            error: function(...args) {
              const message = args[0]?.toString() || '';
              if (isExtensionError(message)) return;
              originalConsoleError.apply(console, args);
            },
            warn: function(...args) {
              const message = args[0]?.toString() || '';
              if (isExtensionError(message)) return;
              originalConsoleWarn.apply(console, args);
            },
            log: function(...args) {
              const message = args[0]?.toString() || '';
              if (isExtensionError(message)) return;
              originalConsoleLog.apply(console, args);
            }
          }
        });
        
        console.log('üõ°Ô∏è Filtro AGRESIVO de errores de extensiones activado');
      })();
    </script>
    
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
